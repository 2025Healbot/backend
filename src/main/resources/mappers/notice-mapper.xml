<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hospital.boot.domain.notice.model.mapper.NoticeMapper">

    <!-- 전체 공지사항 목록 조회 -->
    <select id="getAllNotices" resultType="com.hospital.boot.domain.notice.model.vo.Notice">
        SELECT
            NOTICE_NO as noticeId,
            NOTICE_SUBJECT as title,
            NOTICE_CONTENT as content,
            CATEGORY as category,
            VIEW_COUNT as viewCount,
            TO_CHAR(WRITE_DATE, 'YYYY-MM-DD"T"HH24:MI:SS') as createdAt,
            TO_CHAR(WRITE_DATE, 'YYYY-MM-DD"T"HH24:MI:SS') as updatedAt
        FROM NOTICE
        ORDER BY WRITE_DATE DESC
    </select>

    <!-- 공지사항 생성 -->
    <insert id="insertNotice" parameterType="com.hospital.boot.domain.notice.model.vo.Notice">
        <selectKey keyProperty="noticeId" resultType="int" order="BEFORE">
            SELECT NVL(MAX(NOTICE_NO), 0) + 1 FROM NOTICE
        </selectKey>
        INSERT INTO NOTICE (
            NOTICE_NO,
            USER_ID,
            NOTICE_SUBJECT,
            NOTICE_CONTENT,
            NOTICE_WRITER,
            WRITE_DATE,
            VIEW_COUNT,
            CATEGORY
        ) VALUES (
            #{noticeId},
            'admin',
            #{title},
            #{content},
            'ADMIN',
            SYSDATE,
            0,
            #{category}
        )
    </insert>

    <!-- 공지사항 수정 -->
    <update id="updateNotice" parameterType="com.hospital.boot.domain.notice.model.vo.Notice">
        UPDATE NOTICE
        SET
            NOTICE_SUBJECT = #{title},
            NOTICE_CONTENT = #{content},
            CATEGORY = #{category}
        WHERE NOTICE_NO = #{noticeId}
    </update>

    <!-- 공지사항 삭제 -->
    <delete id="deleteNotice">
        DELETE FROM NOTICE
        WHERE NOTICE_NO = #{noticeId}
    </delete>

    <!-- 공지사항 조회수 증가 -->
    <update id="incrementViews">
        UPDATE NOTICE
        SET VIEW_COUNT = VIEW_COUNT + 1
        WHERE NOTICE_NO = #{noticeId}
    </update>

</mapper>